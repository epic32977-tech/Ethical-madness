# ... (inside your script) ...

# 5. Securing & Validating (Frank's Way)
echo "ğŸ›¡ï¸ Securing backup..."
# If you run this in Cron, you MUST provide the passphrase via env or file
if [[ -z "$BACKUP_PASS" ]]; then
    echo "âš ï¸ WARNING: No BACKUP_PASS env var. Manual password entry required."
fi

gpg --batch --yes --pinentry-mode loopback \
    --passphrase "$BACKUP_PASS" -c --cipher-algo AES256 "$TAR_FILE"

# 6. The "Trust but Verify" Step
echo "ğŸ” Testing archive integrity..."
if gpg --batch --yes --passphrase "$BACKUP_PASS" -d "$TAR_FILE.gpg" | tar -tzf - > /dev/null; then
    echo "ğŸ’ Data integrity verified. You can sleep now."
else
    echo "âŒ ERROR: Backup is corrupted! Check your SD card health."
    exit 1
fi
